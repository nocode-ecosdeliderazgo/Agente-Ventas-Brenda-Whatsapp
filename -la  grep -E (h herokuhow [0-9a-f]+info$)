[1mdiff --git a/docs/PROJECT_OVERVIEW.md b/docs/PROJECT_OVERVIEW.md[m
[1mnew file mode 100644[m
[1mindex 0000000..54c5914[m
[1m--- /dev/null[m
[1m+++ b/docs/PROJECT_OVERVIEW.md[m
[36m@@ -0,0 +1,352 @@[m
[32m+[m[32m# PROJECT OVERVIEW - Bot Brenda WhatsApp[m
[32m+[m[32m> **DocumentaciÃ³n TÃ©cnica de Alto Nivel**[m[41m  [m
[32m+[m[32m> **Ãšltima actualizaciÃ³n**: Enero 2025[m
[32m+[m
[32m+[m[32m## ğŸ—ï¸ Resumen ArquitectÃ³nico[m
[32m+[m
[32m+[m[32m### TecnologÃ­as y LibrerÃ­as Clave[m
[32m+[m[32m- **Framework Web**: FastAPI + Uvicorn/Gunicorn[m
[32m+[m[32m- **IA Conversacional**: OpenAI GPT (client v1.30+)[m
[32m+[m[32m- **MensajerÃ­a**: Twilio WhatsApp API[m
[32m+[m[32m- **Base de Datos**: PostgreSQL (asyncpg)[m
[32m+[m[32m- **ConfiguraciÃ³n**: Pydantic Settings + python-dotenv[m
[32m+[m[32m- **ValidaciÃ³n**: Pydantic v2.0+[m
[32m+[m[32m- **Cliente HTTP**: httpx (asÃ­ncrono)[m
[32m+[m
[32m+[m[32m### Estructura de Directorios y Responsabilidades[m
[32m+[m
[32m+[m[32m```[m
[32m+[m[32mapp/[m
[32m+[m[32mâ”œâ”€â”€ config/             # âš™ï¸ ConfiguraciÃ³n centralizada (settings.py)[m
[32m+[m[32mâ”œâ”€â”€ domain/             # ğŸ›ï¸ Entidades de negocio (User, Message, Course, etc.)[m
[32m+[m[32mâ”œâ”€â”€ application/        # ğŸ“‹ Casos de uso de negocio[m
[32m+[m[32mâ”‚   â””â”€â”€ usecases/       # â–¶ï¸ Flujos principales del bot[m
[32m+[m[32mâ”œâ”€â”€ infrastructure/     # ğŸ”§ Adaptadores externos[m[41m [m
[32m+[m[32mâ”‚   â”œâ”€â”€ twilio/         # ğŸ“± Cliente WhatsApp[m
[32m+[m[32mâ”‚   â”œâ”€â”€ openai/         # ğŸ¤– Cliente IA[m
[32m+[m[32mâ”‚   â”œâ”€â”€ database/       # ğŸ—„ï¸ PostgreSQL + repositorios[m
[32m+[m[32mâ”‚   â””â”€â”€ tools/          # ğŸ› ï¸ Sistema de herramientas[m
[32m+[m[32mâ”œâ”€â”€ presentation/       # ğŸŒ Interfaces externas[m
[32m+[m[32mâ”‚   â””â”€â”€ api/            # REST API (webhook.py)[m
[32m+[m[32mâ””â”€â”€ templates/          # ğŸ“ Templates de respuestas[m
[32m+[m
[32m+[m[32mmemory/                 # ğŸ’¾ Sistema de memoria persistente[m
[32m+[m[32mconfig/                 # ğŸ”§ ConfiguraciÃ³n legacy (twilio_settings.py)[m
[32m+[m[32mresources/              # ğŸ“„ Archivos estÃ¡ticos (PDFs, imÃ¡genes)[m
[32m+[m[32mprompts/                # ğŸ§  Templates de prompts IA[m
[32m+[m[32m```[m
[32m+[m
[32m+[m[32m### Punto de Entrada Principal[m
[32m+[m[32m- **Webhook FastAPI**: `app/presentation/api/webhook.py`[m
[32m+[m[32m- **Puerto**: 8000 (configurable)[m
[32m+[m[32m- **Endpoints**:[m
[32m+[m[32m  - `POST /webhook` - Recibe mensajes de Twilio[m
[32m+[m[32m  - `GET /` - Health check[m
[32m+[m
[32m+[m[32m---[m
[32m+[m
[32m+[m[32m## ğŸš€ Flujos de Negocio Productivos[m
[32m+[m
[32m+[m[32m### â–¶ï¸ Flujo de Bienvenida[m
[32m+[m[32m**Archivo**: `app/application/usecases/welcome_flow_use_case.py`[m
[32m+[m
[32m+[m[32m**Responsabilidades**:[m
[32m+[m[32m- Ofrecer catÃ¡logo de cursos disponibles[m
[32m+[m[32m- Asegurar selecciÃ³n obligatoria de un curso[m[41m  [m
[32m+[m[32m- Guardar curso seleccionado en memoria[m
[32m+[m[32m- Transicionar a agente inteligente personalizado[m
[32m+[m
[32m+[m[32m**Estados**:[m
[32m+[m[32m- `privacy_flow_completed` â†’ ofrece cursos[m
[32m+[m[32m- `waiting_for_response: "course_selection"` â†’ procesa selecciÃ³n[m
[32m+[m[32m- `selected_course` definido â†’ activa agente inteligente[m
[32m+[m
[32m+[m[32m### ğŸ” Flujo de Privacidad[m[41m  [m
[32m+[m[32m**Archivo**: `app/application/usecases/privacy_flow_use_case.py`[m
[32m+[m
[32m+[m[32m**Etapas**:[m
[32m+[m[32m1. **Solicitud inicial**: Pide consentimiento de privacidad[m
[32m+[m[32m2. **ValidaciÃ³n nombre**: Extrae/solicita nombre del usuario[m
[32m+[m[32m3. **Solicitud rol**: Pide rol profesional (opcional)[m
[32m+[m[32m4. **Completado**: `stage = "privacy_flow_completed"`[m
[32m+[m
[32m+[m[32m**Flags clave**:[m
[32m+[m[32m- `privacy_accepted: bool`[m
[32m+[m[32m- `privacy_requested: bool`[m[41m [m
[32m+[m[32m- `waiting_for_response: "privacy_acceptance" | "user_name" | "user_role"`[m
[32m+[m
[32m+[m[32m### âœ… Flujo de ConfirmaciÃ³n RÃ¡pida (`PAYMENT_CONFIRMATION`)[m
[32m+[m[32m**Archivo**: `app/application/usecases/generate_intelligent_response.py:2289`[m
[32m+[m
[32m+[m[32m**Responsabilidades**:[m
[32m+[m[32m- Detecta intenciÃ³n `PAYMENT_CONFIRMATION`[m[41m [m
[32m+[m[32m- EnvÃ­a datos bancarios + bonos activos[m
[32m+[m[32m- Conecta con asesor especializado[m
[32m+[m[32m- Formatea respuesta con `WhatsAppBusinessTemplates.payment_confirmation_advisor_contact()`[m
[32m+[m
[32m+[m[32m**Intenciones relacionadas**:[m
[32m+[m[32m- `PAYMENT_COMPLETED` - Pago ya realizado[m
[32m+[m[32m- `COMPROBANTE_UPLOAD` - Comprobante enviado[m
[32m+[m
[32m+[m[32m### ğŸ’³ Flujo de Oferta de Datos Bancarios + Bono[m
[32m+[m[32m**Archivo**: `app/application/usecases/purchase_bonus_use_case.py`[m
[32m+[m
[32m+[m[32m**Funcionalidad**:[m
[32m+[m[32m- Activa con `purchase_bonus_sent: bool = False`[m
[32m+[m[32m- Obtiene bonos activos desde BD (`bond` table)[m
[32m+[m[32m- EnvÃ­a datos bancarios para transferencia[m
[32m+[m[32m- Marca `purchase_bonus_sent: bool = True`[m
[32m+[m
[32m+[m[32m### ğŸ“š Flujo de Consulta de Curso / PDF[m
[32m+[m[32m**Archivos**:[m[41m [m
[32m+[m[32m- `app/application/usecases/query_course_information.py`[m
[32m+[m[32m- `app/application/usecases/course_announcement_use_case.py`[m
[32m+[m
[32m+[m[32m**Funcionalidades**:[m
[32m+[m[32m- Consulta PostgreSQL (tabla `ai_courses`)[m
[32m+[m[32m- EnvÃ­a PDFs desde `/resources/course_materials/`[m
[32m+[m[32m- Templates personalizados por curso[m
[32m+[m[32m- IntegraciÃ³n con sistema de herramientas[m
[32m+[m
[32m+[m[32m### ğŸ› ï¸ Sistema de Herramientas[m
[32m+[m[32m**Archivos**:[m
[32m+[m[32m- `app/infrastructure/tools/tool_system.py` - Framework base[m
[32m+[m[32m- `app/infrastructure/tools/tool_db.py` - Consultas DB[m
[32m+[m[32m- `app/application/usecases/tool_activation_use_case.py` - ActivaciÃ³n inteligente[m
[32m+[m
[32m+[m[32m**Herramientas Disponibles**:[m
[32m+[m[32m- `EnviarRecursosGratuitos` - Recursos educativos[m
[32m+[m[32m- `MostrarSyllabusInteractivo` - Programa detallado[m
[32m+[m[32m- `EnviarPreviewCurso` - Vista previa[m
[32m+[m[32m- `MostrarComparativaPrecios` - ComparaciÃ³n de precios[m
[32m+[m[32m- `MostrarBonosExclusivos` - Bonos especiales[m
[32m+[m[32m- `ContactarAsesorDirecto` - EscalaciÃ³n humana[m
[32m+[m
[32m+[m[32m**ActivaciÃ³n por IntenciÃ³n**:[m
[32m+[m[32m- `EXPLORATION` â†’ Recursos + Syllabus[m
[32m+[m[32m- `OBJECTION_PRICE` â†’ Comparativa precios + Bonos[m
[32m+[m[32m- `BUYING_SIGNALS` â†’ Contacto asesor[m
[32m+[m[32m- MÃ¡ximo 2 herramientas por interacciÃ³n[m
[32m+[m
[32m+[m[32m---[m
[32m+[m
[32m+[m[32m## ğŸ—„ï¸ Modelo de Datos[m
[32m+[m
[32m+[m[32m### Tablas PostgreSQL Relevantes[m
[32m+[m
[32m+[m[32m#### `ai_courses` - CatÃ¡logo Maestro[m
[32m+[m[32m```sql[m
[32m+[m[32mid_course (uuid, PK)[m
[32m+[m[32mname, short_description, long_description[m
[32m+[m[32mprice, currency[m
[32m+[m[32msession_count, total_duration_min[m[41m  [m
[32m+[m[32mlevel (bÃ¡sico/intermedio/avanzado)[m
[32m+[m[32mmodality (online/presencial/hÃ­brido)[m
[32m+[m[32mstatus, start_date, end_date[m
[32m+[m[32m```[m
[32m+[m
[32m+[m[32m#### `bond` - Bonos y Recursos Extra[m
[32m+[m[32m```sql[m
[32m+[m[32mid_bond (bigint, PK)[m
[32m+[m[32mcontent, type_bond[m
[32m+[m[32mid_courses_fk â†’ ai_courses[m[41m  [m
[32m+[m[32mbond_url, active[m
[32m+[m[32m```[m
[32m+[m
[32m+[m[32m#### `ai_course_session` - Sesiones del Curso[m
[32m+[m[32m```sql[m
[32m+[m[32mid_session (uuid, PK)[m
[32m+[m[32msession_index, title, objective[m
[32m+[m[32mduration_minutes, scheduled_at[m
[32m+[m[32mid_course_fk â†’ ai_courses[m
[32m+[m[32m```[m
[32m+[m
[32m+[m[32m#### `elements_url` - Recursos Multimedia[m
[32m+[m[32m```sql[m
[32m+[m[32mid_element (uuid, PK)[m[41m  [m
[32m+[m[32mitem_type, url_test, description_url[m
[32m+[m[32mid_session_fk, id_activity_fk[m
[32m+[m[32m```[m
[32m+[m
[32m+[m[32m### Relaciones Principales[m
[32m+[m[32m```[m
[32m+[m[32mai_courses 1 â”€â”€â”€â”€< ai_course_session 1 â”€â”€â”€â”€< ai_tema_activity[m
[32m+[m[32m   |                                 \[m
[32m+[m[32m   |                                  > elements_url[m
[32m+[m[32m   |[m
[32m+[m[32m   â””â”€â”€â”€ 1 â”€â”€â”€â”€< bond (bonos por curso)[m
[32m+[m[32m```[m
[32m+[m
[32m+[m[32m---[m
[32m+[m
[32m+[m[32m## ğŸ’¾ Persistencia de Memoria del Lead[m
[32m+[m
[32m+[m[32m### Archivo Principal[m
[32m+[m[32m`memory/lead_memory.py` - Clase `LeadMemory`[m
[32m+[m
[32m+[m[32m### Campos Principales[m
[32m+[m
[32m+[m[32m#### Estados del Flujo[m
[32m+[m[32m```python[m
[32m+[m[32mstage: str = "first_contact"  # first_contact, privacy_flow, course_selection, sales_agent, converted[m
[32m+[m[32mcurrent_flow: str = "none"    # none, privacy, course_selection, sales_conversation[m[41m  [m
[32m+[m[32mflow_step: int = 0            # paso actual dentro del flujo[m
[32m+[m[32mwaiting_for_response: str     # name, privacy_acceptance, course_choice, etc.[m
[32m+[m[32m```[m
[32m+[m
[32m+[m[32m#### InformaciÃ³n del Usuario[m
[32m+[m[32m```python[m
[32m+[m[32muser_id: str[m
[32m+[m[32mname: str = ""[m
[32m+[m[32mrole: Optional[str] = None[m
[32m+[m[32mselected_course: str = ""[m
[32m+[m[32mprivacy_accepted: bool = False[m
[32m+[m[32mprivacy_requested: bool = False[m
[32m+[m[32m```[m
[32m+[m
[32m+[m[32m#### PersonalizaciÃ³n Avanzada (Fase 2)[m
[32m+[m[32m```python[m
[32m+[m[32mbuyer_persona_match: str      # lucia_copypro, marcos_multitask, sofia_visionaria, etc.[m
[32m+[m[32mprofessional_level: str      # junior, mid-level, senior, executive[m
[32m+[m[32mcompany_size: str            # startup, small, medium, large, enterprise[m[41m  [m
[32m+[m[32mindustry_sector: str         # marketing, operations, tech, consulting, etc.[m
[32m+[m[32mtechnical_level: str         # beginner, intermediate, advanced[m
[32m+[m[32mdecision_making_power: str   # influencer, decision_maker, budget_holder[m
[32m+[m[32m```[m
[32m+[m
[32m+[m[32m#### Scoring y SeÃ±ales[m
[32m+[m[32m```python[m
[32m+[m[32mlead_score: int = 50[m
[32m+[m[32minteraction_count: int = 0[m
[32m+[m[32minterest_level: str = "unknown"[m
[32m+[m[32mpain_points: List[str] = [][m
[32m+[m[32mbuying_signals: List[str] = [][m
[32m+[m[32murgency_signals: List[str] = [][m
[32m+[m[32mbudget_indicators: List[str] = [][m
[32m+[m[32m```[m
[32m+[m
[32m+[m[32m#### Flags de Control[m
[32m+[m[32m```python[m
[32m+[m[32mbrenda_introduced: bool = False           # Si ya se presentÃ³ Brenda[m
[32m+[m[32mpurchase_bonus_sent: bool = False         # Si ya se enviaron datos bancarios[m
[32m+[m[32moriginal_message_body: Optional[str]      # Mensaje que iniciÃ³ el flujo[m
[32m+[m[32m```[m
[32m+[m
[32m+[m[32m### MÃ©todos Ãštiles[m
[32m+[m[32m- `is_first_interaction()` - Primera vez del usuario[m
[32m+[m[32m- `needs_privacy_flow()` - Necesita flujo de privacidad[m[41m  [m
[32m+[m[32m- `is_ready_for_sales_agent()` - Listo para agente inteligente[m
[32m+[m[32m- `is_high_value_lead()` - Lead de alto valor[m
[32m+[m[32m- `get_recommended_approach()` - Estrategia de comunicaciÃ³n[m
[32m+[m
[32m+[m[32m### Almacenamiento[m
[32m+[m[32m- **Directorio**: `memorias/` (configurable)[m
[32m+[m[32m- **Formato**: JSON (`memory_{user_id}.json`)[m
[32m+[m[32m- **Backup**: AutomÃ¡tico antes de guardar[m
[32m+[m[32m- **Cache**: En memoria durante ejecuciÃ³n[m
[32m+[m
[32m+[m[32m---[m
[32m+[m
[32m+[m[32m## âš ï¸ Puntos CrÃ­ticos / TODOs[m
[32m+[m
[32m+[m[32m### TODOs Prioritarios[m
[32m+[m
[32m+[m[32m#### `app/application/usecases/generate_intelligent_response.py`[m
[32m+[m[32m```python[m
[32m+[m[32m# LÃ­nea 328: Mejorar anÃ¡lisis de intenciÃ³n incluyendo info de curso[m
[32m+[m[32m# LÃ­nea 1323: Implementar envÃ­o de recursos[m[41m  [m
[32m+[m[32m# LÃ­nea 1328: Implementar flujo de contacto con asesor[m
[32m+[m[32m# LÃ­nea 1333: Implementar envÃ­o de overview del curso[m
[32m+[m[32m```[m
[32m+[m
[32m+[m[32m#### `app/infrastructure/tools/tool_system.py`[m
[32m+[m[32m```python[m
[32m+[m[32m# LÃ­nea 122: Mensaje personalizado de recursos (implementar despuÃ©s)[m
[32m+[m[32m# LÃ­nea 161: Generar mensaje formateado syllabus (implementar despuÃ©s)[m[41m  [m
[32m+[m[32m# LÃ­nea 257: Generar mensaje personalizado con ROI (implementar despuÃ©s)[m
[32m+[m[32m# LÃ­nea 293: Generar mensaje con bonos reales (implementar despuÃ©s)[m
[32m+[m[32m```[m
[32m+[m
[32m+[m[32m#### `prompts/tool_prompts.py`[m
[32m+[m[32m```python[m
[32m+[m[32m# LÃ­nea 5: Agregar mÃ¡s plantillas para bonos, demos, cierre, etc.[m
[32m+[m[32m```[m
[32m+[m
[32m+[m[32m### Componentes Legacy/Obsoletos[m
[32m+[m
[32m+[m[32m#### Evitar Consultar[m
[32m+[m[32m- `tests/` - Tests desactualizados, usar solo como referencia[m
[32m+[m[32m- `core/whatsapp_agent.py` - Agente legacy sin integrar[m[41m  [m
[32m+[m[32m- `handlers/whatsapp_webhook.py` - Webhook legacy[m
[32m+[m[32m- `config/twilio_settings.py` - ConfiguraciÃ³n legacy (usar `app/config/settings.py`)[m
[32m+[m
[32m+[m[32m#### Archivos de Desarrollo[m
[32m+[m[32m- `test_*.py` en raÃ­z - Scripts de testing, no productivos[m
[32m+[m[32m- `run_*.py` - Scripts de desarrollo local[m
[32m+[m[32m- `fix_*.py` - Scripts de reparaciÃ³n temporal[m
[32m+[m
[32m+[m[32m### LÃ³gica Temporal/Hardcoded[m
[32m+[m
[32m+[m[32m#### En `app/presentation/api/webhook.py`[m
[32m+[m[32m- InicializaciÃ³n con fallbacks para falta de OpenAI/PostgreSQL[m
[32m+[m[32m- Modo FALLBACK si OpenAI falla (lÃ­neas 237-279)[m
[32m+[m[32m- Debug prints extensos (remover en producciÃ³n)[m
[32m+[m
[32m+[m[32m#### En `memory/lead_memory.py`[m[41m  [m
[32m+[m[32m- Buyer personas hardcoded (lÃ­neas 142-180)[m
[32m+[m[32m- Scoring manual de leads (lÃ­nea 190-215)[m
[32m+[m
[32m+[m[32m---[m
[32m+[m
[32m+[m[32m## ğŸš¦ Estado Actual del Sistema[m
[32m+[m
[32m+[m[32m### âœ… Funcionalidades Operativas[m
[32m+[m[32m- Webhook FastAPI recibiendo mensajes Twilio âœ…[m
[32m+[m[32m- Sistema de memoria persistente completo âœ…[m[41m  [m
[32m+[m[32m- Flujo de privacidad funcional âœ…[m
[32m+[m[32m- Consultas PostgreSQL a catÃ¡logo de cursos âœ…[m
[32m+[m[32m- Templates de respuesta estructurados âœ…[m
[32m+[m[32m- Sistema de herramientas (framework base) âœ…[m
[32m+[m
[32m+[m[32m### ğŸš§ En Desarrollo[m[41m  [m
[32m+[m[32m- PersonalizaciÃ³n avanzada de respuestas ğŸš§[m
[32m+[m[32m- Sistema de bonos dinÃ¡mico ğŸš§[m
[32m+[m[32m- AnÃ¡lisis de buyer persona automÃ¡tico ğŸš§[m
[32m+[m[32m- MÃ©tricas y analytics ğŸš§[m
[32m+[m
[32m+[m[32m### â³ Pendiente[m
[32m+[m[32m- Tests automatizados â³[m
[32m+[m[32m- DocumentaciÃ³n de API â³[m[41m  [m
[32m+[m[32m- Monitoreo y logging estructurado â³[m
[32m+[m[32m- OptimizaciÃ³n de performance â³[m
[32m+[m
[32m+[m[32m---[m
[32m+[m
[32m+[m[32m## ğŸ“‹ GuÃ­as de Desarrollo[m
[32m+[m
[32m+[m[32m### Para Agregar Nuevo Flujo[m
[32m+[m[32m1. Crear caso de uso en `app/application/usecases/`[m
[32m+[m[32m2. Integrar en `ProcessIncomingMessageUseCase`[m
[32m+[m[32m3. Agregar templates en `app/templates/`[m
[32m+[m[32m4. Actualizar memoria en `LeadMemory`[m
[32m+[m
[32m+[m[32m### Para Nueva Herramienta[m
[32m+[m[32m1. Heredar de `BaseTool` en `tool_system.py`[m
[32m+[m[32m2. Implementar mÃ©todo `execute()`[m
[32m+[m[32m3. Registrar en `ToolActivationSystem`[m
[32m+[m[32m4. Mapear intenciÃ³n en `intent_tool_mapping`[m
[32m+[m
[32m+[m[32m### Para Nueva Entidad[m
[32m+[m[32m1. Crear en `app/domain/entities/`[m
[32m+[m[32m2. Agregar repositorio en `app/infrastructure/database/repositories/`[m
[32m+[m[32m3. Actualizar esquema en `db_schema_condensed.md`[m
[32m+[m
[32m+[m[32m### Debugging[m
[32m+[m[32m- Usar `debug_print()` en archivos principales[m
[32m+[m[32m- Logs estructurados con mÃ³dulo `logging`[m
[32m+[m[32m- Webhook debugger: `run_webhook_server_debug.py`[m
[32m+[m[32m- Simulador: scripts `test_*.py`[m
[32m+[m
[32m+[m[32m---[m
[32m+[m
[32m+[m[32m**Nota**: Esta documentaciÃ³n refleja el estado de Enero 2025. Para cambios recientes consultar git log y PRs activos.[m
\ No newline at end of file[m
